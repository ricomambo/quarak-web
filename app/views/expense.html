<h1 class="page-header">{{project.title}}</h1>

<div class="row">
  <div class="col-md-3 well well-sm">
    <h3>Balance</h3>
    <ul class="list-group">
      <li class="list-group-item" ng-repeat="balance in balances">
        <b>{{balance.member.name}}</b> <span class="pull-right label balance-amount" ng-class="{'label-success': balance.balance >= 0, 'label-danger': balance.balance < 0}">{{balance.balance | currency}}</span>
      </li>
    </ul>
  </div>
  <div class="col-md-9">
    <h3>Expenses</h3>

    <input placeholder="Search" ng-model="search" class="form-control" q-clear-on-esc>

    <form id="expense-form" name="expenseForm" ng-submit="save(activeExpense)">
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Provider</th>
            <th>Amount</th>
            <th>Payer</th>
            <th>Members</th>
            <th>Comments</th>
            <th>Category</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <input
                placeholder="Date"
                class="form-control"
                ng-model="activeExpense.date"
                required>
            </td>
            <td>
              <input
                placeholder="Provider"
                class="form-control"
                ng-model="activeExpense.provider"
                autofocus
                required>
            </td>
            <td>
              <input
                placeholder="Amount"
                class="form-control"
                ng-model="activeExpense.amount"
                required>
            </td>
            <td>
              <select
                ng-model="activeExpense.payer_id"
                ng-options="member.id as member.name for member in project.members"
                class="form-control"
                required>
              </select>
            </td>
            <td>
              <select
                multiple="multiple"
                ng-model="activeExpense.members"
                ng-options="member.name for member in project.members | filter: {active: 'true'}"
                class="form-control"
                required>
              </select>
            </td>
            <td>
              <input
                placeholder="Comments"
                class="form-control"
                ng-model="activeExpense.comments"
                required>
            </td>
            <td>
              <input
                placeholder="Category"
                class="form-control"
                ng-model="activeExpense.category"
                required>
            </td>
            <td>
              <button class="btn btn-primary" type="submit" ng-disabled="expenseForm.$invalid">Save</button>
            </td>
          </tr>
        </tbody>
        <tbody>
          <tr ng-repeat="expense in expenses | filter:search | orderBy:['-date', '-id']">
            <td>{{expense.date}}</td>
            <td>{{expense.provider}}</td>
            <td>{{expense.amount}}</td>
            <td>{{expense.payer.name}}</td>
            <td>{{displayMembers(expense.members)}}</td>
            <td>{{expense.comments}}</td>
            <td>{{expense.category}}</td>
            <td><a href="" ng-click="remove(expense)"><span class="glyphicon glyphicon-remove"></span></a></td>
          </tr>
        </tbody>
      </table>
    </form>
  </div>
</div>
